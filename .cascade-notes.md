# Cascade Reference Notes - Dotfiles Configuration

## Project Overview
- Uses Nix/home-manager for configuration management
- Uses GNU Stow for symlink management
- Configuration is managed through a flake-based setup
- Located at `/home/chungsam/dotfiles`

## Directory Structure
```
dotfiles/
├── bootstrap.sh          # Main setup script
└── nix/                  # Nix configuration
    ├── setup.sh         # Nix-specific setup
    └── .config/         # Stow-managed config directory
        ├── nix/
        │   └── nix.conf
        └── home-manager/
            ├── flake.nix
            └── home.nix
```

## Important Commands

### Setup Commands
```bash
# Fresh installation
./bootstrap.sh

# Apply configuration changes
home-manager switch --flake ~/.config/home-manager#$USER --impure -b backup

# Manual stow command if needed
stow -v --no-folding nix -t ~
```

### Development Commands
```bash
# Check configuration status
home-manager news
home-manager generations

# Roll back to previous generation
home-manager generations
home-manager switch --flake /nix/store/xxx-home-manager-generation

# Clean up old generations
home-manager expire-generations "-30 days"
```

### Git Commands
```bash
# Commit message format used
git commit -m "type: description

- Detailed point 1
- Detailed point 2"

# Types used:
# - feat: new feature
# - fix: bug fix
# - refactor: code restructuring
# - docs: documentation updates
# - style: formatting changes
# - chore: maintenance tasks
```

## Configuration Details

### Home Manager
- Located in `~/.config/home-manager/home.nix`
- Uses flakes with impure evaluation
- Username placeholder (@USER@) in flake.nix for portability
- Backup flag (-b backup) enabled during switch

### Stow
- Uses `--no-folding` to prevent nested symlinks
- Target directory is user's home (~)
- Configuration files are in `nix/.config/`

### Tmux Configuration
- Managed by home-manager
- Uses Catppuccin theme
- Vim-like keybindings
- Custom split and navigation bindings

## Common Tasks

### Adding a New Tool
1. Add to home.packages in home.nix:
```nix
home.packages = with pkgs; [
  new-package
];
```

### Adding Tool Configuration
1. Add to programs section in home.nix:
```nix
programs = {
  new-tool = {
    enable = true;
    # tool-specific settings
  };
};
```

### Debugging Tips
1. Check symlinks:
```bash
ls -la ~/.config/home-manager
ls -la ~/.config/nix
```

2. Check Nix store for current generation:
```bash
readlink ~/.nix-profile
```

3. View home-manager logs:
```bash
journalctl --user -u home-manager-cascade
```

## Notes
- Always run bootstrap.sh from the dotfiles root directory
- Configuration changes require running home-manager switch
- Keep flake.nix and home.nix in sync
- Remember to commit changes to both configuration and documentation
