#!/usr/bin/env bash

set -euo pipefail

# Toggle voice-to-text recording.
# Sends SIGUSR1 to the voice-recorder daemon (started via systemd).
# If daemon is not running, shows a notification.

PID_FILE="/tmp/voice-recorder.pid"

if [ -f "$PID_FILE" ]; then
    pid=$(cat "$PID_FILE")
    if kill -0 "$pid" 2>/dev/null; then
        kill -USR1 "$pid"
        exit 0
    fi
    # Stale PID file â€” clean up
    rm -f "$PID_FILE"
fi

# Daemon not running
notify-send -a "Voice Recorder" -t "5000" "Voice-to-Text" \
    "Daemon not running. Start with: systemctl --user start voice-recorder"
