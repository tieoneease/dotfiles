#!/usr/bin/env bash

set -euo pipefail

# Toggle voice-to-text recording.
# If voice-recorder is not running, launch it.
# If it is running, send SIGUSR1 to stop recording and trigger transcription.

PID_FILE="/tmp/voice-recorder.pid"

if [ -f "$PID_FILE" ]; then
    pid=$(cat "$PID_FILE")
    if kill -0 "$pid" 2>/dev/null; then
        # Recorder is running — signal it to stop and transcribe
        kill -USR1 "$pid"
        exit 0
    fi
    # Stale PID file — clean up
    rm -f "$PID_FILE"
fi

# No recorder running — launch one
~/.local/bin/voice-recorder &
